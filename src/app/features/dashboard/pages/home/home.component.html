<!-- Home: plantilla — estadísticas, actividad y paginación -->

<div class="dashboard-container">
  <!-- ESTADO DE CARGA -->
  @if (isLoading()) {
  <div class="loading-section">
    <div class="loading-spinner"></div>
    <p class="loading-text">Cargando tu dashboard...</p>
  </div>
  }

  <!-- ESTADO DE ERROR -->
  @if (error() && !isLoading()) {
  <div class="error-section">
    <div class="error-icon"><mat-icon>warning</mat-icon></div>
    <p class="error-text">{{ error() }}</p>
    <button class="retry-button" (click)="refreshDashboard()">
      Reintentar
    </button>
  </div>
  }

  <!-- CONTENIDO PRINCIPAL -->
  @if (!isLoading() && !error()) {
  <!-- SECCIÓN DE BIENVENIDA -->
  <section class="welcome-section">
    <div class="welcome-content">
      <div class="user-info">
        <img [src]="userAvatar()" [alt]="userDisplayName()" class="user-avatar" (error)="onImageError($event)" />
        <div class="user-details">
          <div class="name-badge-container">
            <h1 class="welcome-title">¡Hola, {{ userDisplayName() }}!</h1>
            @if (isAdmin()) {
            <div class="admin-badge">ADMINISTRADOR</div>
            }
          </div>
          @if (isAdmin()) {
          <p class="welcome-subtitle">Panel de Administración - MindHub</p>
          } @else {
          <p class="welcome-subtitle">Bienvenido de vuelta a tu dashboard</p>
          }
        </div>
      </div>
      <button class="refresh-button" (click)="refreshDashboard()" title="Actualizar datos">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="23,4 23,10 17,10" />
          <polyline points="1,20 1,14 7,14" />
          <path d="M20.49,9A9,9,0,0,0,5.64,5.64L1,10m22,4L18.36,18.36A9,9,0,0,1,3.51,15" />
        </svg>
      </button>
    </div>
  </section>

  <!-- SECCIÓN DE ESTADÍSTICAS -->
  <section class="stats-section">
    @if (isAdmin()) {
    <h2 class="section-title">MÉTRICAS DE ADMINISTRACIÓN</h2>
    } @else {
    <h2 class="section-title">MI ACTIVIDAD SOCIAL</h2>
    }
    <div class="stats-grid" [class.admin-grid]="isAdmin()">
      @for (stat of socialStats(); track stat.label) {
      <div class="stat-card" [style.--stat-color]="stat.color" [class.admin-stat]="isAdmin()">
        <mat-icon class="stat-icon">{{ stat.icon }}</mat-icon>
        <div class="stat-content">
          <div class="stat-value">{{ stat.value | number }}</div>
          <div class="stat-label">{{ stat.label }}</div>
        </div>
      </div>
      }
    </div>
  </section>

  <!-- SECCIÓN DE ACTIVIDAD -->
  <section class="activity-section">
    @if (isAdmin()) {
    <h2 class="section-title">ACCIONES ADMINISTRATIVAS RECIENTES</h2>
    } @else {
    <h2 class="section-title">ACTIVIDAD RECIENTE</h2>
    }

    <div class="activity-list" [class.loading]="isLoadingActivity()" [class.transitioning]="isTransitioning()">
      @if (recentActivity().length > 0) {
      @for (activity of recentActivity(); track activity.id) {
      <div class="activity-item fade-in" [class.admin-activity]="isAdmin()" [style.animation-delay.ms]="$index * 50">
        <div class="activity-icon">
          <mat-icon class="activity-mat-icon" [attr.data-icon]="activity.icon">{{ activity.icon }}</mat-icon>
        </div>
        <div class="activity-content">
          <p class="activity-text">{{ activity.text }}</p>
          <span class="activity-time">{{ activity.time | dateFormat:'long' }}</span>
        </div>
      </div>
      }

      <!-- Estado de carga durante paginación -->
      <div class="activity-loading" [class.visible]="isLoadingActivity()">
        <div class="activity-loading-spinner"></div>
        <span class="activity-loading-text">{{ isAdmin() ? 'Cargando acciones...' : 'Cargando actividad...' }}</span>
      </div>

      <!-- PAGINACIÓN -->
      @if (totalPages() > 1) {
      <app-pagination [currentPage]="currentPage()" [totalPages]="totalPages()" [totalElements]="totalElements()"
        [isLoading]="isLoadingActivity()" [showInfo]="true" (pageChange)="goToPage($event)" (previous)="previousPage()"
        (next)="nextPage()">
      </app-pagination>
      }
      } @else {
      <!-- ESTADO VACÍO -->
      <div class="empty-activity">
        @if (isAdmin()) {
        <div class="empty-icon"><mat-icon>settings</mat-icon></div>
        <p class="empty-text">No hay acciones administrativas recientes</p>
        <p class="empty-subtitle">Las acciones de administración aparecerán aquí</p>
        } @else {
        <div class="empty-icon"><mat-icon>mail_outline</mat-icon></div>
        <p class="empty-text">No tienes actividad reciente</p>
        <p class="empty-subtitle">¡Empieza a interactuar para ver tu actividad aquí!</p>
        }
      </div>
      }
    </div>
  </section>
  }
</div>

<!-- FOOTER -->
<app-footer></app-footer>