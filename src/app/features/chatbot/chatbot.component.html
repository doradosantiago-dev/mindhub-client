<!-- Chatbot: plantilla â€” encabezado, mensajes, input y estados -->
<div class="chatbot-container" [class.open]="isOpen()" [class.minimized]="isMinimized()" role="dialog"
  aria-label="Chatbot asistente virtual" [attr.aria-hidden]="!isOpen()" [attr.aria-modal]="isOpen()">

  <!--
      HEADER DEL CHATBOT
    -->
  <div class="chatbot-header" role="banner" aria-label="Encabezado del chatbot">
    <div class="chatbot-title" role="heading" aria-level="1">
      <!-- AVATAR DEL BOT -->
      <div class="bot-avatar" aria-hidden="true">
        <div class="robot-container">
          <!-- Antenas -->
          <div class="robot-antenna left"></div>
          <div class="robot-antenna right"></div>
          <!-- Cabeza -->
          <div class="robot-head">
            <!-- Ojos -->
            <div class="robot-eyes">
              <div class="robot-eye left"></div>
              <div class="robot-eye right"></div>
            </div>
            <!-- Boca -->
            <div class="robot-mouth"></div>
          </div>
          <!-- Cuerpo -->
          <div class="robot-body">
            <div class="robot-panel"></div>
          </div>
        </div>
      </div>

      <!-- CONTENIDO DEL TÃTULO -->
      <div class="title-content">
        <h3>Asistente Virtual</h3>
        <span class="status" [class.online]="!isTyping()" role="status" aria-live="polite"
          [attr.aria-label]="isTyping() ? 'El bot estÃ¡ escribiendo' : 'Bot en lÃ­nea'">
          {{ isTyping() ? 'Escribiendo...' : 'En lÃ­nea' }}
        </span>
      </div>
    </div>

    <!-- ACCIONES DEL HEADER -->
    <div class="header-actions" role="toolbar" aria-label="Acciones del chatbot">
      @if (messages().length > 1) {
      <button class="action-btn reset-btn" (click)="resetConversation()" type="button"
        aria-label="Reiniciar conversaciÃ³n" title="Reiniciar conversaciÃ³n">
        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          aria-hidden="true">
          <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" />
          <path d="M21 3v5h-5" />
          <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" />
          <path d="M3 21v-5h5" />
        </svg>
      </button>
      }

      <button class="action-btn minimize-btn" (click)="toggleMinimize()" type="button" [class.minimized]="isMinimized()"
        aria-label="Minimizar chatbot" title="Minimizar">
        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          aria-hidden="true">
          <path d="M18 15l-6-6-6 6" />
        </svg>
      </button>

      <button class="action-btn close-btn" (click)="closeChatbot()" type="button" aria-label="Cerrar chatbot"
        title="Cerrar">
        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          aria-hidden="true">
          <line x1="18" y1="6" x2="6" y2="18" />
          <line x1="6" y1="6" x2="18" y2="18" />
        </svg>
      </button>
    </div>
  </div>

  <!-- PANEL DE MENSAJES -->
  @if (!isMinimized()) {
  <div #chatMessages class="chat-messages" role="log" aria-label="ConversaciÃ³n del chatbot" aria-live="polite">

    @if (messages().length > 0) {
    @for (message of messages(); track message.id) {
    <div class="message" [class.user-message]="message.messageType === 'USER'"
      [class.bot-message]="message.messageType === 'CHATBOT'" role="listitem"
      [attr.aria-label]="'Mensaje de ' + (message.messageType === 'USER' ? 'usuario' : 'bot') + ': ' + message.content">

      <!-- CONTENIDO DEL MENSAJE -->
      <div class="message-content">
        <div class="message-text">{{ message.content }}</div>
        <time class="message-time" [attr.datetime]="message.creationDate"
          aria-label="Hora del mensaje: {{ message.creationDate | dateFormat:'short' }}">
          {{ message.creationDate | dateFormat:'short' }}
        </time>
      </div>
    </div>
    }
    }

    <!-- INDICADOR DE ESCRITURA -->
    @if (isTyping()) {
    <div class="message bot-message typing" role="status" aria-live="polite" aria-label="El bot estÃ¡ escribiendo">
      <div class="message-content">
        <div class="typing-indicator" aria-hidden="true">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </div>
    }
  </div>
  }

  <!-- CONTENEDOR DE INPUT -->
  @if (!isMinimized()) {
  <div class="chat-input-container" role="form" aria-label="Enviar mensaje">
    <div class="input-wrapper">
      <textarea class="chat-input" [value]="currentInput()" (input)="onInputChange($event)"
        (keydown)="onKeyPress($event)" placeholder="Escribe tu mensaje..." rows="1" [disabled]="isTyping()"
        aria-label="Escribe tu mensaje" aria-describedby="send-button">
        </textarea>

      <button id="send-button" class="send-btn" (click)="sendMessage()" type="submit"
        [disabled]="!currentInput().trim() || isTyping()" aria-label="Enviar mensaje" title="Enviar mensaje">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          aria-hidden="true">
          <line x1="22" y1="2" x2="11" y2="13" />
          <polygon points="22,2 15,22 11,13 2,9" />
        </svg>
      </button>
    </div>
  </div>
  }

  <!-- CONTENIDO MINIMIZADO -->
  @if (isMinimized()) {
  <div class="minimized-content" role="status" aria-live="polite" aria-label="Chatbot minimizado">
    <div class="minimized-message">
      <span aria-hidden="true">ðŸ’¬</span>
      <span>Chat minimizado</span>
    </div>
  </div>
  }
</div>